env: "prod"
site_url: "http://trader.r-e.kr"

# 자동매매/주문/잔고 기능은 제거된 "조회 전용" 서버입니다.
# 데이터 수집 스크립트에서 KIS API를 쓰려면 아래 환경변수를 설정하세요:
#   KIS_APP_KEY, KIS_APP_SECRET, KIS_ACCOUNT_NO(선택)

# Discord 알림 (DB 작업 모니터링)
discord:
  enabled: true
  webhook: "${DISCORD_WEBHOOK_URL}"
  # Reduce spam: only allow digest-style messages (e.g. selection summary).
  digest_only: true
  allow_prefixes:
    - "[selection]"
    - "[VIEWER-KR]"
    - "[monitor]"

kis:
  env: "prod"
  base_url_prod: "https://openapi.koreainvestment.com:9443"
  base_url_paper: "https://openapivts.koreainvestment.com:29443"
  ws_url_prod: "ws://ops.koreainvestment.com:21000"
  ws_url_paper: "ws://ops.koreainvestment.com:31000"
  app_key: "${KIS_APP_KEY}"
  app_secret: "${KIS_APP_SECRET}"
  use_hashkey: true
  hashkey_cache_ttl_sec: 30
  account_no: "${KIS_ACCOUNT_NO}"
  custtype: "P"
  token_cache_path: ".cache/kis_token.json"
  # 10 requests per second
  rate_limit_sleep_sec: 0.1
  accuracy_rate_limit_sleep_sec: 0.1
  timeout_connect_sec: 5
  timeout_read_sec: 20
  max_retries: 6
  backoff_base_sec: 2
  backoff_cap_sec: 60
  backoff_jitter_sec: 0.5
  consecutive_error_cooldown_after: 10
  consecutive_error_cooldown_sec: 180
  auth_forbidden_cooldown_sec: 600
  session_reset_every: 3

database:
  path: "data/market_data.db"

# DB -> CSV export (선택)
export_csv:
  enabled: false
  out_dir: "data/csv"
  mode: "overwrite"
  tables: []

monitor:
  enabled: true
  scan_interval_sec: 60
  rest_batch_size: 30
  rest_max_retries: 5
  max_ws_subs: 20
  ws_subscribe_interval_sec: 0.2
  subscribe_cooldown_sec: 180
  alert_cooldown_sec: 600
  selection_api: "http://127.0.0.1/selection"
  universe_paths:
    - "data/universe_kospi200.csv"
    - "data/universe_kosdaq150.csv"
  state_path: "data/monitor_state.json"
  ws_tr_id: "H0STCNT0"
  signal:
    type: "disparity_threshold"
    disparity_threshold: -0.08
    use_intraday: true

watchdog:
  interval_sec: 60
  status_notify_interval_sec: 1800
  daily_enabled: true
  daily_min_missing: 1
  daily_stale_days: 1
  daily_chunk_days: 90
  daily_cooldown_sec: 900
  accuracy_min_missing: 1
  accuracy_cooldown_sec: 21600
  accuracy_notify_every: 20
  accuracy_item_sleep_sec: 0.5

# Universe CSV 파일 경로 (KOSPI200 + KOSDAQ150)
universe:
  groups:
    - path: "data/universe_kospi200.csv"
      group_name: "KOSPI200"
    - path: "data/universe_kosdaq150.csv"
      group_name: "KOSDAQ150"

# 예시 전략 파라미터 (selection 후보 계산에만 사용)
strategy:
  entry_mode: "mean_reversion"
  liquidity_rank: 350
  min_amount: 50000000000  # 500억
  rank_mode: "amount"
  disparity_buy_kospi: -0.05
  disparity_buy_kosdaq: -0.10
  disparity_sell: -0.01
  stop_loss: -0.05
  max_holding_days: 3
  max_positions: 10
  max_per_sector: 0
  trend_ma25_rising: false
  selection_horizon_days: 1
